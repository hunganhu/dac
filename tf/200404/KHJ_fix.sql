USE TF_KHJ
GO

SELECT LEFT(MIN_INQUIRY_DATE,6), COUNT(*), COUNT(DISTINCT IDN)
FROM dbo.data_availability
GROUP BY LEFT(MIN_INQUIRY_DATE,6)
ORDER BY LEFT(MIN_INQUIRY_DATE,6)
GO
/*
NULL	703	703
200402	96	96
200403	2033	2033
200404	1981	1981
200405	1843	1843
200406	1422	1422
200407	1501	1501
200408	1259	1259
200409	2871	2871
200410	2982	2982
200411	1981	1981
200412	1897	1897
*/

--Load gender
select count(*) 
from tf_khj.dbo.data_availability as a left join tf_khj.dbo.gender as b
on a.idn = b.idn
where b.idn is null
--0
select count(*) 
from tf_khj.dbo.gender as a left join tf_khj.dbo.data_availability as b  
on a.idn = b.idn
where b.idn is null
--0
select a.idn, a.gender, b.gender
from tf_khj.dbo.gender as a left join tf_khj.dbo.application as b
on a.idn = b.idn
where a.gender != isnull(b.gender,999)
--0
ALTER TABLE tf_khj.dbo.application ADD NEW_GENDER Char(3)
GO

UPDATE tf_khj.dbo.application
SET
NEW_GENDER = a.gender
FROM tf_khj.dbo.gender AS A INNER JOIN tf_khj.dbo.application AS B
ON A.IDN = B.IDN
GO

UPDATE BAM085
SET
TIME_STAMP = MIN_INQUIRY_DATE
FROM dbo.data_availability AS A INNER JOIN BAM085 AS B
ON A.IDN = B.IDN
WHERE A.INQUIRY_DATE_DIFF BETWEEN 1 AND 15
GO
--132
UPDATE KRM001
SET
TIME_STAMP = MIN_INQUIRY_DATE
FROM dbo.data_availability AS A INNER JOIN KRM001 AS B
ON A.IDN = B.IDN
WHERE A.INQUIRY_DATE_DIFF BETWEEN 1 AND 15
GO
--200
UPDATE KRM023
SET
TIME_STAMP = MIN_INQUIRY_DATE
FROM dbo.data_availability AS A INNER JOIN KRM023 AS B
ON A.IDN = B.IDN
WHERE A.INQUIRY_DATE_DIFF BETWEEN 1 AND 15
GO
--997
UPDATE JAS002
SET
TIME_STAMP = MIN_INQUIRY_DATE
FROM dbo.data_availability AS A INNER JOIN JAS002 AS B
ON A.IDN = B.IDN
WHERE A.INQUIRY_DATE_DIFF BETWEEN 1 AND 15
GO
--18
UPDATE STM001
SET
TIME_STAMP = MIN_INQUIRY_DATE
FROM dbo.data_availability AS A INNER JOIN STM001 AS B
ON A.IDN = B.IDN
WHERE A.INQUIRY_DATE_DIFF BETWEEN 1 AND 15
GO
--202
SELECT JCIC_MONTH, COUNT(*)
FROM dbo.data_availability
GROUP BY JCIC_MONTH
ORDER BY JCIC_MONTH
/*
NULL	703
200401	3
200402	1044
200403	2017
200404	1950
200405	1703
200406	1374
200407	1369
200408	2250
200409	2716
200410	2640
200411	1846
200412	954
*/
--We will generate variables from 200403 - 200404
SELECT *
INTO BAM085_200403
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200403')
GO
--8601
SELECT *
INTO JAS002_200403
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200403')
GO
--2017
SELECT *
INTO KRM001_200403
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200403')
GO
--12177
SELECT *
INTO KRM023_200403
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200403')
GO
--53715
SELECT *
INTO STM001_200403
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200403')
GO
--12121
CREATE INDEX IDX ON BAM085_200403(IDN)
CREATE INDEX IDX ON JAS002_200403(IDN)
CREATE INDEX IDX ON KRM001_200403(IDN)
CREATE INDEX IDX ON KRM023_200403(IDN)
CREATE INDEX IDX ON STM001_200403(IDN)
GO
SELECT *
INTO BAM085_200404
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200404')
GO
--8115
SELECT *
INTO JAS002_200404
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200404')
GO
--1949
SELECT *
INTO KRM001_200404
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200404')
GO
--11479
SELECT *
INTO KRM023_200404
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200404')
GO
--48999
SELECT *
INTO STM001_200404
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200404')
GO
--12382
CREATE INDEX IDX ON BAM085_200404(IDN)
CREATE INDEX IDX ON JAS002_200404(IDN)
CREATE INDEX IDX ON KRM001_200404(IDN)
CREATE INDEX IDX ON KRM023_200404(IDN)
CREATE INDEX IDX ON STM001_200404(IDN)
GO

SELECT COUNT(*)
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200404')
GO
--16716
SELECT COUNT(*)
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200404')
GO
--3966
SELECT COUNT(*)
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200404')
GO
--23656
SELECT COUNT(*)
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200404')
GO
--102714
SELECT COUNT(*)
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200404')
GO
--24503
SELECT *
INTO BAM085_200405
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200405')
GO

SELECT *
INTO JAS002_200405
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200405')
GO

SELECT *
INTO KRM001_200405
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200405')
GO

SELECT *
INTO KRM023_200405
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200405')
GO

SELECT *
INTO STM001_200405
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200405')
GO

CREATE INDEX IDX ON BAM085_200405(IDN)
CREATE INDEX IDX ON JAS002_200405(IDN)
CREATE INDEX IDX ON KRM001_200405(IDN)
CREATE INDEX IDX ON KRM023_200405(IDN)
CREATE INDEX IDX ON STM001_200405(IDN)
GO

SELECT COUNT(*)
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200405')
GO

SELECT COUNT(*)
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200405')
GO

SELECT COUNT(*)
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200405')
GO

SELECT COUNT(*)
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200405')
GO

SELECT COUNT(*)
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200405')
GO

SELECT *
INTO BAM085_200406
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200406')
GO

SELECT *
INTO JAS002_200406
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200406')
GO

SELECT *
INTO KRM001_200406
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200406')
GO

SELECT *
INTO KRM023_200406
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200406')
GO

SELECT *
INTO STM001_200406
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200406')
GO

CREATE INDEX IDX ON BAM085_200406(IDN)
CREATE INDEX IDX ON JAS002_200406(IDN)
CREATE INDEX IDX ON KRM001_200406(IDN)
CREATE INDEX IDX ON KRM023_200406(IDN)
CREATE INDEX IDX ON STM001_200406(IDN)
GO

SELECT COUNT(*)
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200406')
GO

SELECT *
INTO BAM085_200407
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200407')
GO

SELECT *
INTO JAS002_200407
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200407')
GO

SELECT *
INTO KRM001_200407
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200407')
GO

SELECT *
INTO KRM023_200407
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200407')
GO

SELECT *
INTO STM001_200407
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200407')
GO

CREATE INDEX IDX ON BAM085_200407(IDN)
CREATE INDEX IDX ON JAS002_200407(IDN)
CREATE INDEX IDX ON KRM001_200407(IDN)
CREATE INDEX IDX ON KRM023_200407(IDN)
CREATE INDEX IDX ON STM001_200407(IDN)
GO

SELECT COUNT(*)
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200407')
GO

SELECT *
INTO BAM085_200408
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200408')
GO

SELECT *
INTO JAS002_200408
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200408')
GO

SELECT *
INTO KRM001_200408
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200408')
GO

SELECT *
INTO KRM023_200408
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200408')
GO

SELECT *
INTO STM001_200408
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200408')
GO

CREATE INDEX IDX ON BAM085_200408(IDN)
CREATE INDEX IDX ON JAS002_200408(IDN)
CREATE INDEX IDX ON KRM001_200408(IDN)
CREATE INDEX IDX ON KRM023_200408(IDN)
CREATE INDEX IDX ON STM001_200408(IDN)
GO

SELECT COUNT(*)
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200408')
GO

SELECT *
INTO BAM085_200409
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200409')
GO

SELECT *
INTO JAS002_200409
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200409')
GO

SELECT *
INTO KRM001_200409
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200409')
GO

SELECT *
INTO KRM023_200409
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200409')
GO

SELECT *
INTO STM001_200409
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200409')
GO

CREATE INDEX IDX ON BAM085_200409(IDN)
CREATE INDEX IDX ON JAS002_200409(IDN)
CREATE INDEX IDX ON KRM001_200409(IDN)
CREATE INDEX IDX ON KRM023_200409(IDN)
CREATE INDEX IDX ON STM001_200409(IDN)
GO

SELECT COUNT(*)
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200409')
GO

SELECT *
INTO BAM085_200410
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200410')
GO

SELECT *
INTO JAS002_200410
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200410')
GO

SELECT *
INTO KRM001_200410
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200410')
GO

SELECT *
INTO KRM023_200410
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200410')
GO

SELECT *
INTO STM001_200410
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200410')
GO

CREATE INDEX IDX ON BAM085_200410(IDN)
CREATE INDEX IDX ON JAS002_200410(IDN)
CREATE INDEX IDX ON KRM001_200410(IDN)
CREATE INDEX IDX ON KRM023_200410(IDN)
CREATE INDEX IDX ON STM001_200410(IDN)
GO

SELECT COUNT(*)
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200410')
GO

SELECT *
INTO BAM085_200411
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200411')
GO

SELECT *
INTO JAS002_200411
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200411')
GO

SELECT *
INTO KRM001_200411
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200411')
GO

SELECT *
INTO KRM023_200411
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200411')
GO

SELECT *
INTO STM001_200411
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200411')
GO

CREATE INDEX IDX ON BAM085_200411(IDN)
CREATE INDEX IDX ON JAS002_200411(IDN)
CREATE INDEX IDX ON KRM001_200411(IDN)
CREATE INDEX IDX ON KRM023_200411(IDN)
CREATE INDEX IDX ON STM001_200411(IDN)
GO

SELECT COUNT(*)
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200411')
GO

SELECT *
INTO BAM085_200412
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200412')
GO

SELECT *
INTO JAS002_200412
FROM JAS002
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200412')
GO

SELECT *
INTO KRM001_200412
FROM KRM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200412')
GO

SELECT *
INTO KRM023_200412
FROM KRM023
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200412')
GO

SELECT *
INTO STM001_200412
FROM STM001
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH = '200412')
GO

CREATE INDEX IDX ON BAM085_200412(IDN)
CREATE INDEX IDX ON JAS002_200412(IDN)
CREATE INDEX IDX ON KRM001_200412(IDN)
CREATE INDEX IDX ON KRM023_200412(IDN)
CREATE INDEX IDX ON STM001_200412(IDN)
GO

SELECT COUNT(*)
FROM BAM085
WHERE IDN IN
(SELECT IDN FROM dbo.data_availability WHERE JCIC_MONTH BETWEEN '200403' AND '200412')
GO
