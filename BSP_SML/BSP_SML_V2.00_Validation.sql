SELECT COUNT(*) FROM RESULT

SELECT A.MSN, A.HIGHEST_1, B.HIGHEST_1, A.HIGHEST_2, B.HIGHEST_2, A.UNSECURED_NPV, B.UNSECURED_NPV
FROM RESULT AS A INNER JOIN RESULT_M3_NEW3_REL AS B
ON A.MSN = B.MSN
WHERE (A.HIGHEST_1 != B.HIGHEST_1) OR
      (A.HIGHEST_2 != B.HIGHEST_2)

/*
0002-0254224-SC-09-1	560000	560000	300000	400000	10035.394531311877	14217.309854681198
0001-0918558-AA-19-3	1160000	1160000	500000	510000	16591.76812555403	16595.886293679385
0001-0668238-BC-28-4	5000000	5000000	500000	550000	14317.3684625843	14411.185918542958
0001-0959049-BC-07-1	450000	450000	400000	450000	21077.746885691315	23998.312631375466
0002-0248778-SC-29-3	960000	960000	500000	570000	23239.992406595928	23619.648467588791
0001-0528058-SS-27-3	730000	730000	500000	730000	34091.88171504908	39454.319363531911
0001-0213043-CC-07-1	510000	510000	400000	510000	26155.510608069042	27263.016243302773
0001-0622322-BC-06-2	870000	870000	800000	870000	40262.678167377191	43569.20455227507
0002-0214624-CC-04-2	700000	700000	600000	700000	41922.349293993233	43447.424267931288
0001-0061811-CC-02-2	460000	460000	400000	460000	20749.918953247223	23704.010064853188
0001-0815845-BB-07-1	1510000	1510000	100000	400000	4377.4583830738284	12830.702161665802
0001-0380150-SS-25-3	1360000	1360000	500000	870000	27344.674525753526	33280.329564628395
0002-0778198-BB-26-4	3200000	3200000	500000	900000	29003.616382105512	36017.471557522083
0002-0979159-BB-27-3	1220000	1220000	400000	690000	25539.822143368663	32172.213682137346
0002-1044534-BB-18-4	1520000	1520000	300000	370000	5817.012880079541	7335.7693075066336
0001-0759439-BS-02-2	580000	580000	200000	400000	6798.6743888339697	11452.77557031755
*/


DELETE FROM Applicants WHERE MSN NOT IN
(
0002-0254224-SC-09-1
0001-0918558-AA-19-3
0001-0668238-BC-28-4
0001-0959049-BC-07-1
0002-0248778-SC-29-3
0001-0528058-SS-27-3
0001-0213043-CC-07-1
0001-0622322-BC-06-2
0002-0214624-CC-04-2
0001-0061811-CC-02-2
0001-0815845-BB-07-1
0001-0380150-SS-25-3
0002-0778198-BB-26-4
'0002-0979159-BB-27-3',
'0002-1044534-BB-18-4',
'0001-0759439-BS-02-2',

)


DELETE FROM Applicants WHERE MSN NOT IN(
'0002-0979159-BB-27-3',
'0002-1044534-BB-18-4',
'0001-0759439-BS-02-2',
'0001-0815845-BB-07-1',
'0002-0254224-SC-09-1')
/*
0001-0815845-BB-07-1	1510000	1510000	100000	400000	4377.4583830738284	12830.702161665802----capped by high personal risk
0002-0254224-SC-09-1	560000	560000	300000	400000	10035.394531311877	14217.309854681198----capped by high personal risk
0002-1044534-BB-18-4	1520000	1520000	300000	370000	5817.012880079541	7335.7693075066336----capped by high personal risk
0002-0979159-BB-27-3	1220000	1220000	400000	690000	25539.822143368663	32172.213682137346----capped by high personal risk
0001-0759439-BS-02-2	580000	580000	200000	400000	6798.6743888339697	11452.77557031755 ----capped by high personal risk
*/


SELECT *
FROM BSP_T.dbo.RESULT AS A INNER JOIN BSP_T2.dbo.RESULT AS B
ON A.MSN = B.MSN
WHERE
(A.MSN != B.MSN) OR 
(A.IDN != B.IDN) OR 
(A.IDN1 != B.IDN1) OR 
(A.IDN2 != B.IDN2) OR 
(A.TIME_STAMP != B.TIME_STAMP) OR 
(A.TEST_CELL != B.TEST_CELL) OR 
(A.HIGHEST_1 != B.HIGHEST_1) OR 
(A.HIGHEST_2 != B.HIGHEST_2) OR 
(A.RISK_SCORE != B.RISK_SCORE) OR 
(A.RISK_CUT != B.RISK_CUT) OR 
(A.PROPENSITY_DECILE != B.PROPENSITY_DECILE) OR 
(A.REVIEWED != B.REVIEWED) OR 
(A.SECURED_NPV != B.SECURED_NPV) OR 
(A.UNSECURED_NPV != B.UNSECURED_NPV) OR 
(A.SECURED_PB != B.SECURED_PB) OR 
(A.DECLINE_REASON != B.DECLINE_REASON) OR 
(A.UNSECURED_PB != B.UNSECURED_PB)


ALTER TABLE RESULT_M3_NEW3_REL ADD P_DECILE INT
GO

UPDATE RESULT_M3_NEW3_REL SET P_DECILE = (CASE WHEN RESERVED3 <=-1766.96 THEN 1
 WHEN RESERVED3 <=1215.25 THEN 2 WHEN RESERVED3 <=3306.38 THEN 3
 WHEN RESERVED3 <=5422.75 THEN 4 WHEN RESERVED3 <=7761.67 THEN 5
 WHEN RESERVED3 <=10909.35 THEN 6 WHEN RESERVED3 <=14857.95 THEN 7
 WHEN RESERVED3 <=21364.09 THEN 8 WHEN RESERVED3 <=29957.94 THEN 9
 WHEN RESERVED3 >29957.94 THEN 10 ELSE 0 END)

SELECT A.MSN, B.RISK_SCORE, (A.P_DECILE -1) 
FROM RESULT_M3_NEW3_REL AS A INNER JOIN RESULT AS B
ON A.MSN = B.MSN
WHERE A.RISK_SCORE < 100 AND
      RIGHT(RTRIM(LTRIM(CONVERT(CHAR(20), B.RISK_SCORE))),1) != (A.P_DECILE -1)

